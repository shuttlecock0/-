# 데이터베이스 정규화

관계형 데이터베이스의 설계 단계에서 재구성하는 기술로 데이터의 중복을 최소화(불필요한 데이터 삭제)하고

삽입/갱신/삭제 시 발생할 수 있는 각종 이상현상 방지함



NF(Normal Form)

1NF, 2NF, 3NF, BCNF, 4NF, 5NF

각 정규화 단계는 이전 정규화 단계를 만족함



### 1차 정규화

컬럼이 **원자값**을 가짐 = 컬럼의 값이 1개씩만 존재



<Student Table>

| Student | Age  | Subject              |
| ------- | ---- | -------------------- |
| K       | 16   | Earth science, Maths |
| Roberts | 15   | Maths                |
| Terry   | 17   | Maths                |

위 표에서 학생 K의 Subject의 값은 두 개이므로 컬럼의 원자성을 만족하지 못한다.

제1 정규화를 적용하면



<Student Table>

| Student | Age  | Subject       |
| ------- | ----- | ------------- |
| K       | 16   | Earth science |
| K       | 16   | Maths         |
| Roberts | 15   | Maths         |
| Terry   | 17   | Maths         |



### 2차 정규화

기본키가 아닌 모든 속성이 기본키에 **완전 함수 종속**되면 제2 정규형

칼럼이 **완전 함수적 종속**을 만족 = <u>키 중</u>에 특정 컬럼에만 종속된 컬럼**(부분적 종속)이 없어야 함**

- **함수적 종속**: X의 값에 따라 Y값이 결정될 때 X -> Y로 표현하는데, 이를 Y는 X에 대해 **함수적 종속** 이라고 한다.
- X를 **결정자**, Y는 **종속자**라고 함.

함수적 종속에서 X의 값이 여러 요소일 경우, 즉{X1, X2} -> Y일 경우, X1과 X2가 Y의 값을 결정할 때 **완전 함수적 종속** 이라고 하며 X1, X2 중 하나만 Y의 값을 결정할 때 이를 **부분 함수적 종속**이라고 한다. 이처럼 키의 일부에만 종속적인 관계를 가지는것을 **부분 함수적 종속**관계라고 한다.

<Grade Table>

| 학번      | 과목코드 | 성적 | 전공             | 등록금 |
| --------- | -------- | ---- | ---------------- | ------ |
| 201211773 | AAA11111 | A+   | IT융합응용공학과 | 200    |
| 201211773 | AAA11112 | A    | IT융합응용공학과 | 200    |
| 201211773 | AAA11113 | B+   | IT융합응용공학과 | 200    |
| 201452522 | BBB12345 | B    | 컴퓨터공학과     | 205    |
| 201515882 | CCC54321 | C+   | 전자공학과       | 210    |
| 201619552 | AAA11111 | C    | IT융합응용공학과 | 200    |

함수적 종속성

```
{학번, 과목코드} -> 성적
{학번, 과목코드} -> 전공
{학번, 과목코드} -> 등록금
학번 -> 전공
학번 -> 등록금
전공 -> 등록금
```

여기서 기본 키 {학번, 과목코드}중 '학번'칼럼은 `학번->전공`, `학번->등록금` 두 개의 **부분 함수 종속성**을 가지고 있다. 즉 키의 구성 요서 중 하나인 '학번'만으로 '전공'과 '등록금'을 결정 지을 수 있다.

제2 정규화를 하면


<Student Table>

| <u>학번</u> | 전공             | 등록금 |
| ----------- | ---------------- | ------ |
| 201211773   | IT융합응용공학과 | 200    |
| 201452522   | 컴퓨터공학과     | 205    |
| 201515882   | 전자공학과       | 210    |
| 201619552   | IT융합응용공학과 | 200    |

<Grade Table>

| <u>학번</u> | <u>과목코드</u> | 성적 |
| ----------- | --------------- | ---- |
| 201211773   | AAA11111        | A+   |
| 201211773   | AAA11112        | A    |
| 201211773   | AAA11113        | B+   |
| 201452522   | BBB12345        | B    |
| 201515882   | CCC54321        | C+   |
| 201619552   | AAA11111        | C    |



### 3차 정규화

 *<u>기본키가 아닌 모든 속성</u>이 기본키에 **이행적 함수 종속**이 되지 않으면* **제 3 정규형**이다. 

- **이행적 함수 종속**: X, Y, Z에 대해 X > Y이고 Y > Z가 성립하면 이를 Z가 X에 이행적으로 함수 종속
- X -> Y, Y -> Z 함수적 종속관계로 인해 X -> Z의 이행적 함수 종속 관계가 나타나면[X, Y], [Y, Z] 두 릴레이션으로 분해

즉, 기본키 이외의 다른 칼럼이 그외 다른 칼럼을 결정할 수 없는 것입니다.

<Student Table>

| 학번      | 전공             | 등록금 |
| --------- | ---------------- | ------ |
| 201211773 | IT융합응용공학과 | 200    |
| 201452522 | 컴퓨터공학과     | 205    |
| 201515882 | 전자공학과       | 210    |
| 201619552 | IT융합응용공학과 | 200    |

`학번 -> 전공`

`전공 -> 등록금`

`학번 -> 등록금`

전공에 따라 등록금이 결정되는 것이지 학번에 따라 결정되는 것은 아니다. 즉 기본키가 아닌 등록금은 학번에 이행적 함수로 종속되어있다.

제 3 정규화를 적용하면



<Major Table>

| 학번      | 전공             |
| --------- | ---------------- |
| 201211773 | IT융합응용공학과 |
| 201452522 | 컴퓨터공학과     |
| 201515882 | 전자공학과       |
| 201619552 | IT융합응용공학과 |

<Fee Table>

| 전공             | 등록금 |
| ---------------- | ------ |
| IT융합응용공학과 | 200    |
| 컴퓨터공학과     | 205    |
| 전자공학과       | 210    |



###  BCNF

BCNF(Boyce and Codd Noraml Form), **강한 제 3 정규형** = strong 3NF

**모든 결정자가 후보키 집합에 속한 정규형**

릴레이션 R의 후보키가 1개 밖에 없고, R의 후보키가 기본키가 되고, 3NF를 만족하면 항상 BCNF 를 만족 

후보키가 여러개인 경우에는 3NF를 만족시키지만 이상현상이 발생할 수 있음



BCNF 를 위반하는 릴레이션은 이론적으로는 아래와 같은 구조를 가지게 된다. (A, B 가 키) 

<img src="https://user-images.githubusercontent.com/47841725/66812159-58b15080-ef6d-11e9-9fa9-cd25cbb43375.png">

<Course Table>

| <u>학번</u> | <u>과목</u>      | 교수   |
| ----------- | ---------------- | ------ |
| 1           | 영상비전처리     | 신봉기 |
| 2           | 알고리즘 및 실습 | 권오흠 |
| 3           | 알고리즘 및 실습 | 권오흠 |

위 테이블에서 후보키는 수퍼키중에 최소성을 만족하므로 (학생, 과목)이 후보키가 될 수 있습니다.

그러나 한 과목은 한 사람의 교수에 의해서 개설된다면 교수에 따라 과목이 결정될 수 있습니다. 그런데 위 테이블에서는 교수가 후보키가 아니므로 BCNF를 만족하지 못합니다. 3차 정규형을 만족하면서 BCNF를 만족하지 않는 경우는 **일반 컬럼이 후보키를 결정**하는 경우입니다. 



<img src="https://user-images.githubusercontent.com/47841725/66811943-ef314200-ef6c-11e9-8613-8c22834194b9.png">

BCNF를 적용하면



<Professor Table>

| <u>교수</u> | 과목             |
| ----------- | ---------------- |
| 신봉기      | 영상비전처리     |
| 권오흠      | 알고리즘 및 실습 |

<Course Table>

| <u>학번</u> | 과목             |
| ----------- | ---------------- |
| 1           | 영상비전처리     |
| 2           | 알고리즘 및 실습 |
| 3           | 알고리즘 및 실습 |

